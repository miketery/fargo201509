#!/usr/bin/python

import json
import requests
import pprint
from shapely.geometry import shape, Point, Polygon, mapping
from shapely.ops import cascaded_union

def gisGetIds(geo):
    url='http://gis.cityoffargo.com/arcgis/rest/services/Basemap/FargoParcels/MapServer/0/query'
    params= {'f':'json',
            'returnIdsOnly':'true',
            'where':'',
            'returnGeometry':'false',
            'geometry':geo,
	    'spatialRel':'esriSpatialRelIntersects',
            'geometryType':'esriGeometryEnvelope',#Polygon',
            'inSR': '102100',
            'outSR': '102100'}
    r = requests.get(url,params=params)
    out=json.loads(r.text)
    return out['objectIds']

geo = '{"rings":[[[-10785446.805073708,5926026.066610649],[-10785676.116158564,5925854.083297009],[-10785657.006901491,5925873.19255408],[-10785485.02358785,5926102.503638934],[-10785313.040274208,5926331.81472379],[-10784739.762562072,5926828.655407643],[-10784166.484849934,5927172.622034926],[-10783383.005310012,5927325.496091496],[-10782503.979484733,5927249.059063211],[-10781854.26474431,5927096.185006641],[-10781128.112975601,5926542.016551574],[-10780784.146348318,5925949.629582365],[-10780726.818577105,5925070.603757086],[-10780726.818577105,5924439.998273734],[-10780803.25560539,5923274.333592387],[-10780975.23891903,5921994.013368612],[-10781491.188859956,5921000.332000906],[-10781796.936973097,5920656.365373624],[-10782427.542456448,5920694.583887766],[-10784166.484849934,5921038.550515048],[-10784949.964389855,5921573.609713044],[-10785561.460616136,5922414.41702418],[-10785580.569873206,5922567.2910807505],[-10785580.569873206,5922911.257708033],[-10785580.569873206,5923503.644677242],[-10785465.914330779,5924554.653816162],[-10785446.805073708,5925815.864782866],[-10785446.805073708,5926026.066610649]]],"spatialReference":{"wkid":102100,"latestWkid":3857}}'
geo = '{"xmin":-10845526.309305778,"ymin":5883259.549285153,"xmax":-10763815.126069034,"ymax":5948689.645497175,"spatialReference":{"wkid":102100,"latestWkid":3857}}'
#pprint.pprint(geo)

with open('arcGISids.json','w') as output:
	json.dump(gisGetIds(geo),output)

exit()


parcelIds = gisGetIds(geo)
#parcelIds=[18687139,18687138]
data = getDetails(",".join(str(v) for v in parcelIds[0:2])) #171 is limit
pprint.pprint(data)
#getDetails(",".join(str(v) for v in parcelIds[172:272]))
#print(parcelIds)



geo = '{"rings":[[[-10796071.552005336,5941351.6907818075],[-10796147.98903362,5941581.001866663],[-10795689.36686391,5941733.875923233],[-10795077.87063763,5942192.498092944],[-10794007.752241638,5942345.372149514],[-10793166.944930501,5942116.061064659],[-10792326.137619367,5941810.312951518],[-10790950.271110235,5941428.127810093],[-10786593.360497985,5940663.757527242],[-10782007.138800882,5940205.135357532],[-10777955.976301773,5940205.135357532],[-10772911.132434957,5940205.135357532],[-10765878.92583273,5940128.698329247],[-10765038.118521595,5940128.698329247],[-10765038.118521595,5939364.328046396],[-10765038.118521595,5938217.77262212],[-10765038.118521595,5936841.9061129885],[-10764885.244465025,5933860.862009871],[-10764732.370408455,5931567.751161318],[-10764655.93338017,5927745.899747065],[-10764655.93338017,5922013.122625684],[-10764961.68149331,5915898.160362879],[-10765267.42960645,5909859.635128358],[-10765726.05177616,5903668.235837268],[-10765726.05177616,5899158.451168448],[-10765955.362861015,5898546.954942168],[-10766643.296115581,5898470.517913883],[-10768172.036681283,5898623.391970453],[-10770465.147529835,5898623.391970453],[-10779408.279839188,5898929.140083592],[-10785064.619932285,5899082.014140163],[-10796835.922288185,5899082.014140163],[-10797676.729599321,5899540.636309873],[-10797523.855542751,5902139.495271565],[-10797523.855542751,5905273.413431254],[-10797370.98148618,5909859.635128358],[-10796988.796344755,5913375.738429472],[-10796683.048231615,5918420.582296287],[-10796530.174175045,5923312.552106531],[-10796377.300118474,5925834.974039938],[-10796377.300118474,5928510.2700299155],[-10796224.426061904,5932714.306585595],[-10796071.552005336,5936918.343141274],[-10796071.552005336,5940587.320498957],[-10796071.552005336,5941351.6907818075]]],"spatialReference":{"wkid":102100,"latestWkid":3857}}'





